# When using a display manager, these environment variables might not be loaded, as the login shell can be skipped, and the window manager is run instead.
# When using startx/initx (current setup), login shell is always executed
#
# note ~/.profile is only run when entering a sh login shell, or a bash login shell without any user bash init files existing in the home folder (.bash_profile)
# zsh doesn't ever run ~/.profile, it only runs ~/.zprofile
# when setting environment variables here, the systemd user environment is not updated with these changes


os=$(uname -s)
if [ "$os" = "Darwin" ]; then
  # Add the Homebrew path to PATH
  export PATH="/opt/homebrew/sbin:/opt/homebrew/bin:$PATH"
fi

PATH="$HOME/.local/share/nvim/mason/bin:$PATH"
PATH="/usr/sbin:$PATH"
PATH="$HOME/.duckdb/cli/latest:$PATH"


PATH="$HOME/.local/bin:$PATH"

# required
# otherwise cargo installed commands are not available on PATH
PATH="$HOME/.cargo/bin:$PATH"
#
# # if exists and is a file
# if [ -f "$HOME/.cargo/env" ]; then
#   . "$HOME/.cargo/env"
# fi

# https://unix.stackexchange.com/a/132117
# Note: DO NOT add this to zshrc / bashrc
# If the ssh-agent is started in an rc file, ssh-agent has to be started manually when remoting over SSH
# SSH_AUTH_SOCK env var is required so all ssh-agents use the same instance across all terminals running on the system
# This makes the ssh private keys available when remoting over SSH
# export SSH_AUTH_SOCK=~/.ssh/ssh-agent.$HOST.sock
# ssh-add -l 2>/dev/null >/dev/null
# if [ $? -ge 2 ]; then
#   eval "$(ssh-agent -a "$SSH_AUTH_SOCK")"
#   ssh-add ~/.ssh/f_github
# fi

export SSH_AUTH_SOCK=~/.ssh/ssh-agent.$HOST.sock

# Use a less strict check: if the exit code is NOT 0 (meaning something failed)
# In many shells, checking for -ne 0 is sufficient to catch both 1 and 2.
# Alternatively, you can check if a new socket needs to be created.

if ! ssh-add -l >/dev/null 2>&1; then
    # Start agent only if the previous ssh-add failed.
    eval "$(ssh-agent -a "$SSH_AUTH_SOCK")"
    ssh-add ~/.ssh/f_github
fi

. "$HOME/.local/share/../bin/env"
